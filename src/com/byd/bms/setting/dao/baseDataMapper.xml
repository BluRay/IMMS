<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.byd.bms.setting.dao.IBaseDataDao">
	<!-- 工厂表映射 -->
	<resultMap type="com.byd.bms.setting.model.BmsBaseFactory" id="factoryMap">
		<id property="id" column="id" />
		<result property="factoryCode" column="factory_code" />
		<result property="factoryName" column="factory_name" />
		<result property="shortName" column="short_name" />
		<result property="area" column="area" />
		<result property="assemblyCode" column="vin_assembly_code" />
		<result property="deleteFlag" column="delete_flag" />
		<result property="memo" column="memo" />
		<result property="editorId" column="editor_id" />
		<result property="editor" column="editor" />
		<result property="editDate" column="edit_date" />
		<result property="capacity" column="capacity" />
	</resultMap>
	<select id="getFactoryList" parameterType="Map" resultMap="factoryMap">
		select f.*,u.display_name editor from BMS_BASE_FACTORY f left join
		BMS_BASE_USER u on u.staff_number=f.editor_id where 1=1 and f.delete_flag='0'
		<if test="factory!=null and factory!=''">
			and (f.factory_name like CONCAT('%',#{factory},'%') or
			f.factory_code like CONCAT('%',#{factory},'%') )
		</if>
		<if test="assembcode!=null and assembcode!=''">
			and f.vin_assembly_code = #{assembcode}
		</if>
		<if test="start !=null">
			LIMIT #{start} ,#{length} 
		</if>

	</select>
	<select id="getFactoryTotalCount" parameterType="Map"
		resultType="int">
		select count(f.id) from BMS_BASE_FACTORY f left join BMS_BASE_USER u
		on u.staff_number=f.editor_id where 1=1 and f.delete_flag='0'
		<if test="factory!=null">
			and (f.factory_name like CONCAT('%',#{factory},'%') or
			f.factory_code like CONCAT('%',#{factory},'%') )
		</if>
		<if test="assembcode!=null">
			and f.vin_assembly_code = #{assembcode}
		</if>
	</select>
	<insert id="addFactory" parameterType="com.byd.bms.setting.model.BmsBaseFactory">
		<selectKey resultType="int" keyProperty="id" order="AFTER">
			SELECT LAST_INSERT_ID() AS id
		</selectKey>
		insert into BMS_BASE_FACTORY
		(factory_code,factory_name,area,vin_assembly_code,memo,editor_id,edit_date,capacity,short_name)
		values(#{factoryCode},#{factoryName},#{area},#{assemblyCode},#{memo},#{editorId},#{editDate},#{capacity},#{shortName})
	</insert>
	<update id="updateFactory" parameterType="com.byd.bms.setting.model.BmsBaseFactory">
		update
		BMS_BASE_FACTORY set
		factory_code=#{factoryCode},factory_name=#{factoryName},vin_assembly_code=#{assemblyCode},
		area=#{area},memo=#{memo},editor_id=#{editorId},edit_date=#{editDate},capacity=#{capacity},short_name=#{shortName}
		where id=#{id}
	</update>
	<update id="deleteFactory" parameterType="java.util.List">

		update BMS_BASE_FACTORY set delete_flag='1' where id in
		<foreach collection="list" item="ids" index="index" open="("
			close=")" separator=",">
			#{ids}
		</foreach>

	</update>
</mapper>
